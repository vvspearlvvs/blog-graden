<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Garden Widget 테스트 페이지</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f6f8fa;
            margin: 0;
            padding: 24px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 32px;
        }
        
        h1 {
            color: #24292f;
            margin-bottom: 8px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #656d76;
            margin-bottom: 32px;
            font-size: 16px;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 24px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            background: #fafbfc;
        }
        
        .test-section h2 {
            color: #24292f;
            margin-top: 0;
            margin-bottom: 16px;
            font-size: 20px;
        }
        
        .widget-container {
            border: 2px dashed #d0d7de;
            border-radius: 8px;
            padding: 20px;
            min-height: 200px;
            background: white;
            margin: 16px 0;
        }
        
        .code-block {
            background: #f6f8fa;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 16px;
            margin: 16px 0;
            overflow-x: auto;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 14px;
        }
        
        .status {
            padding: 12px 16px;
            border-radius: 6px;
            margin: 16px 0;
            font-weight: 500;
        }
        
        .status.success {
            background: #dafbe1;
            color: #1a7f37;
            border: 1px solid #4ac26b;
        }
        
        .status.error {
            background: #ffebe9;
            color: #cf222e;
            border: 1px solid #ff8182;
        }
        
        .status.info {
            background: #f1f8ff;
            color: #0969da;
            border: 1px solid #79c0ff;
        }
        
        .test-buttons {
            margin: 16px 0;
        }
        
        .test-buttons button {
            background: #0969da;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 8px;
            font-size: 14px;
        }
        
        .test-buttons button:hover {
            background: #0858b9;
        }
        
        .test-buttons button:disabled {
            background: #656d76;
            cursor: not-allowed;
        }
        
        .rss-input-section {
            background: #f1f8ff;
            border: 1px solid #79c0ff;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .rss-input-group {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        
        .rss-input-group label {
            font-weight: 600;
            color: #24292f;
            min-width: 120px;
        }
        
        .rss-input-group input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d0d7de;
            border-radius: 6px;
            font-size: 14px;
            min-width: 300px;
        }
        
        .rss-input-group button {
            background: #2da44e;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
        }
        
        .rss-input-group button:hover {
            background: #2c974b;
        }
        
        .example-urls {
            margin-top: 16px;
            padding: 12px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e1e4e8;
        }
        
        .example-urls h4 {
            margin: 0 0 8px 0;
            color: #24292f;
            font-size: 14px;
        }
        
        .example-urls ul {
            margin: 0;
            padding-left: 20px;
            color: #656d76;
            font-size: 13px;
        }
        
        .example-urls li {
            margin-bottom: 4px;
        }
        
        .example-urls a {
            color: #0969da;
            text-decoration: none;
        }
        
        .example-urls a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 Blog Garden Widget 테스트 페이지</h1>
        <div class="subtitle">
            사용자가 직접 RSS URL을 입력하여 위젯을 테스트할 수 있는 페이지입니다.
        </div>

        <!-- RSS URL 입력 섹션 -->
        <div class="rss-input-section">
            <h2>📡 RSS URL 설정</h2>
            <div class="rss-input-group">
                <label for="rss-url-input">RSS URL:</label>
                <input type="url" id="rss-url-input" placeholder="https://your-blog.com/rss" value="https://pearlluck.tistory.com/rss">
                <button onclick="updateWidgets()">위젯 업데이트</button>
            </div>
            <div class="rss-input-group">
                <label for="widget-title-input">위젯 제목:</label>
                <input type="text" id="widget-title-input" placeholder="블로그 활동" value="블로그 활동">
                <button onclick="updateWidgets()">위젯 업데이트</button>
            </div>
        </div>

        <!-- CDN 로드 상태 확인 -->
        <div class="test-section">
            <h2>📡 CDN 로드 상태</h2>
            <div id="cdn-status" class="status info">
                CDN 로드 상태를 확인 중...
            </div>
            <div class="code-block">
&lt;script src="https://unpkg.com/blog-garden-widget@latest/blog-garden-widget.js"&gt;&lt;/script&gt;
&lt;script src="https://unpkg.com/blog-garden-widget@latest/blog-garden-widget-1y.js"&gt;&lt;/script&gt;
            </div>
        </div>

        <!-- 3개월 버전 위젯 테스트 -->
        <div class="test-section">
            <h2>🔧 3개월 버전 위젯 테스트</h2>
            <div class="widget-container">
                <div
                    id="three-month-widget"
                    data-graden-widget
                    data-rss-url="https://pearlluck.tistory.com/rss"
                    data-title="3개월 활동 기록"
                    data-show-legend="true"
                    data-show-footer="true">
                </div>
            </div>
            <div class="code-block">
&lt;div data-graden-widget
     data-rss-url="YOUR_RSS_URL"
     data-title="YOUR_TITLE"
     data-show-legend="true"
     data-show-footer="true"&gt;
&lt;/div&gt;
            </div>
        </div>

        <!-- 1년 버전 위젯 테스트 -->
        <div class="test-section">
            <h2>📅 1년 버전 위젯 테스트</h2>
            <div class="widget-container">
                <div
                    id="yearly-widget"
                    data-graden-widget-1y
                    data-rss-url="https://pearlluck.tistory.com/rss"
                    data-title="1년 활동 기록"
                    data-show-legend="true"
                    data-show-footer="true">
                </div>
            </div>
            <div class="code-block">
&lt;div data-graden-widget-1y
     data-rss-url="YOUR_RSS_URL"
     data-title="YOUR_TITLE"
     data-show-legend="true"
     data-show-footer="true"&gt;
&lt;/div&gt;
            </div>
        </div>

        <!-- 테스트 결과 -->
        <div class="test-section">
            <h2>📊 테스트 결과</h2>
            <div id="test-results" class="status info">
                테스트를 진행하면 결과가 여기에 표시됩니다.
            </div>
        </div>

        <!-- RSS 분석 테스트 -->
        <div class="test-section">
            <h2>🔍 RSS 분석 테스트 (프록시 서버)</h2>
            <div class="test-buttons">
                <button onclick="testRssAnalysis()">RSS 분석 테스트</button>
                <button onclick="testProxyServer()">프록시 서버 상태 확인</button>
            </div>
            <div id="rss-analysis-result" class="status info">
                RSS 분석 결과가 여기에 표시됩니다.
            </div>
        </div>
    </div>

    <!-- 위젯 라이브러리 로드 -->
    <script src="https://unpkg.com/blog-garden-widget@latest/blog-garden-widget.js"></script>
    <script src="https://unpkg.com/blog-garden-widget@latest/blog-garden-widget-1y.js"></script>
    
    <script>
        let currentWidgets = {
            threeMonth: null,
            yearly: null
        };
        
        // RSS URL 설정 함수
        function setRssUrl(url) {
            document.getElementById('rss-url-input').value = url;
            updateWidgets();
        }
        
        // 위젯 업데이트 함수
        function updateWidgets() {
            const rssUrl = document.getElementById('rss-url-input').value;
            const title = document.getElementById('widget-title-input').value;
            
            if (!rssUrl) {
                alert('RSS URL을 입력해주세요.');
                return;
            }
            
            // 기존 위젯 제거
            destroyCurrentWidgets();
            
            // 3개월 버전 위젯 생성
            const threeMonthContainer = document.getElementById('three-month-widget');
            threeMonthContainer.innerHTML = '';
            threeMonthContainer.setAttribute('data-rss-url', rssUrl);
            threeMonthContainer.setAttribute('data-title', title);
            
            if (typeof GradenWidget !== 'undefined') {
                currentWidgets.threeMonth = new GradenWidget(threeMonthContainer, {
                    rssUrl: rssUrl,
                    title: title,
                    showLegend: true,
                    showFooter: true
                });
                updateTestResults('3개월 버전 위젯 생성', '성공');
            } else {
                updateTestResults('3개월 버전 위젯 생성', '실패: GradenWidget 클래스 없음');
            }
            
            // 1년 버전 위젯 생성
            const yearlyContainer = document.getElementById('yearly-widget');
            yearlyContainer.innerHTML = '';
            yearlyContainer.setAttribute('data-rss-url', rssUrl);
            yearlyContainer.setAttribute('data-title', title);
            
            if (typeof GradenWidget1Y !== 'undefined') {
                currentWidgets.yearly = new GradenWidget1Y(yearlyContainer, {
                    rssUrl: rssUrl,
                    title: title,
                    showLegend: true,
                    showFooter: true
                });
                updateTestResults('1년 버전 위젯 생성', '성공');
            } else {
                updateTestResults('1년 버전 위젯 생성', '실패: GradenWidget1Y 클래스 없음');
            }
            
            // 코드 블록 업데이트
            updateCodeBlocks(rssUrl, title);
        }
        
        // 기존 위젯 제거
        function destroyCurrentWidgets() {
            if (currentWidgets.threeMonth && currentWidgets.threeMonth.destroy) {
                currentWidgets.threeMonth.destroy();
                currentWidgets.threeMonth = null;
            }
            if (currentWidgets.yearly && currentWidgets.yearly.destroy) {
                currentWidgets.yearly.destroy();
                currentWidgets.yearly = null;
            }
        }
        
        // 코드 블록 업데이트
        function updateCodeBlocks(rssUrl, title) {
            const codeBlocks = document.querySelectorAll('.code-block');
            codeBlocks.forEach(block => {
                let html = block.innerHTML;
                html = html.replace(/YOUR_RSS_URL/g, rssUrl);
                html = html.replace(/YOUR_TITLE/g, title);
                block.innerHTML = html;
            });
        }
        
        // CDN 로드 상태 확인
        window.addEventListener('load', function() {
            setTimeout(() => {
                if (typeof GradenWidget !== 'undefined' && typeof GradenWidget1Y !== 'undefined') {
                    document.getElementById('cdn-status').className = 'status success';
                    document.getElementById('cdn-status').textContent = '✅ CDN 로드 성공! 모든 위젯 클래스를 사용할 수 있습니다.';
                    updateTestResults('CDN 로드', '성공');
                    
                    // 초기 위젯 생성
                    updateWidgets();
                } else {
                    document.getElementById('cdn-status').className = 'status error';
                    document.getElementById('cdn-status').textContent = '❌ CDN 로드 실패! 일부 위젯 클래스를 찾을 수 없습니다.';
                    updateTestResults('CDN 로드', '실패');
                }
            }, 2000);
        });

        function updateTestResults(test, result) {
            const resultsDiv = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            const newResult = `[${timestamp}] ${test}: ${result}`;
            
            if (resultsDiv.textContent.includes('테스트를 진행하면')) {
                resultsDiv.innerHTML = newResult;
            } else {
                resultsDiv.innerHTML += '<br>' + newResult;
            }
        }

        // RSS 분석 테스트
        async function testRssAnalysis() {
            const resultDiv = document.getElementById('rss-analysis-result');
            const rssUrl = document.getElementById('rss-url-input').value;
            
            if (!rssUrl) {
                alert('RSS URL을 입력해주세요.');
                return;
            }
            
            resultDiv.className = 'status info';
            resultDiv.textContent = 'RSS 분석 중...';
            
            try {
                const response = await fetch(`https://blog-graden.vercel.app/analyze/rss?url=${encodeURIComponent(rssUrl)}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const dateCounts = await response.json();
                
                resultDiv.className = 'status success';
                resultDiv.innerHTML = `
                    <strong>✅ RSS 분석 성공!</strong><br>
                    <strong>URL:</strong> ${rssUrl}<br>
                    <strong>날짜별 게시물 수:</strong><br>
                    <pre style="background: white; padding: 8px; border-radius: 4px; margin-top: 8px;">${JSON.stringify(dateCounts, null, 2)}</pre>
                `;
                
                updateTestResults('RSS 분석', '성공');
            } catch (error) {
                resultDiv.className = 'status error';
                resultDiv.innerHTML = `
                    <strong>❌ RSS 분석 실패!</strong><br>
                    <strong>에러:</strong> ${error.message}<br>
                    <strong>프록시 서버가 실행 중인지 확인해주세요.</strong>
                `;
                
                updateTestResults('RSS 분석', '실패: ' + error.message);
            }
        }

        // 프록시 서버 상태 확인
        async function testProxyServer() {
            const resultDiv = document.getElementById('rss-analysis-result');
            resultDiv.className = 'status info';
            resultDiv.textContent = '프록시 서버 상태 확인 중...';
            
            try {
                const response = await fetch('https://blog-graden.vercel.app/health');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const health = await response.json();
                
                resultDiv.className = 'status success';
                resultDiv.innerHTML = `
                    <strong>✅ 프록시 서버 정상 작동!</strong><br>
                    <strong>상태:</strong> ${health.status}<br>
                    <strong>시간:</strong> ${new Date(health.timestamp).toLocaleString()}
                `;
                
                updateTestResults('프록시 서버 상태', '정상');
            } catch (error) {
                resultDiv.className = 'status error';
                resultDiv.innerHTML = `
                    <strong>❌ 프록시 서버 연결 실패!</strong><br>
                    <strong>에러:</strong> ${error.message}<br>
                    <strong>프록시 서버를 확인해주세요.</strong>
                `;
                
                updateTestResults('프록시 서버 상태', '실패: ' + error.message);
            }
        }
    </script>
</body>
</html> 
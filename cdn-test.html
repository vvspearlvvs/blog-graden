<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Activity Widget 테스트 - 내 블로그에 위젯 적용하기</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 50px;
            color: white;
        }
        
        .header h1 {
            font-size: 36px;
            margin-bottom: 12px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 18px;
            opacity: 0.9;
            margin-bottom: 30px;
        }
        
        .blog-input-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .blog-input-section h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .input-group label {
            font-weight: 600;
            color: #4a5568;
            min-width: 120px;
        }
        
        .input-group input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            min-width: 300px;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #48bb78;
            color: white;
        }
        
        .btn-success:hover {
            background: #38a169;
            transform: translateY(-2px);
        }
        
        .test-step {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border-left: 6px solid #e2e8f0;
            transition: all 0.3s;
        }
        
        .test-step.completed {
            border-left-color: #48bb78;
            background: linear-gradient(135deg, #f0fff4 0%, #f7fafc 100%);
        }
        
        .test-step.error {
            border-left-color: #f56565;
            background: linear-gradient(135deg, #fed7d7 0%, #f7fafc 100%);
        }
        
        .test-step.testing {
            border-left-color: #ed8936;
            background: linear-gradient(135deg, #fef5e7 0%, #f7fafc 100%);
        }
        
        .step-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .step-title {
            color: #2d3748;
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #e2e8f0;
            color: #4a5568;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }
        
        .test-step.completed .step-number {
            background: #48bb78;
            color: white;
        }
        
        .test-step.error .step-number {
            background: #f56565;
            color: white;
        }
        
        .test-step.testing .step-number {
            background: #ed8936;
            color: white;
        }
        
        .step-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .status-pending {
            background: #edf2f7;
            color: #4a5568;
        }
        
        .status-testing {
            background: #fef5e7;
            color: #c05621;
        }
        
        .status-success {
            background: #f0fff4;
            color: #276749;
        }
        
        .status-error {
            background: #fed7d7;
            color: #c53030;
        }
        
        .step-content {
            color: #4a5568;
            line-height: 1.6;
        }
        
        .step-result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 12px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 14px;
        }
        
        .result-success {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-left: 4px solid #38a169;
            color: #22543d;
            margin: 20px 0;
            padding: 20px 24px;
            border-radius: 8px;
            line-height: 1.6;
            box-shadow: 0 2px 4px rgba(56, 161, 105, 0.08);
        }
        
        .result-success strong {
            color: #1a202c;
            font-weight: 600;
        }
        
        .result-success small {
            color: #4a5568;
            font-size: 13px;
            margin-top: 8px;
            display: block;
        }
        
        .result-success a {
            color: #2b6cb0 !important;
            text-decoration: none;
            font-weight: 500;
            border-bottom: 1px dotted #2b6cb0;
            word-break: break-all;
            transition: all 0.2s ease;
            padding: 1px 2px;
        }
        
        .result-success a:hover {
            background: #bee3f8;
            border-bottom: 1px solid #2b6cb0;
            border-radius: 4px;
            padding: 2px 4px;
        }
        
        .result-error {
            background: #fed7d7;
            border: 1px solid #feb2b2;
            border-left: 4px solid #e53e3e;
            color: #742a2a;
            margin: 20px 0;
            padding: 20px 24px;
            border-radius: 8px;
            line-height: 1.6;
            box-shadow: 0 2px 4px rgba(229, 62, 62, 0.08);
        }
        
        .result-error strong {
            color: #1a202c;
            font-weight: 600;
        }
        
        .result-error a {
            color: #2b6cb0 !important;
            text-decoration: none;
            font-weight: 500;
            border-bottom: 1px dotted #2b6cb0;
            word-break: break-all;
            transition: all 0.2s ease;
            padding: 1px 2px;
        }
        
        .result-error a:hover {
            background: #bee3f8;
            border-bottom: 1px solid #2b6cb0;
            border-radius: 4px;
            padding: 2px 4px;
        }
        
        .result-info {
            background: #ebf8ff;
            border: 1px solid #90cdf4;
            border-left: 4px solid #3182ce;
            color: #2a4365;
            margin: 20px 0;
            padding: 20px 24px;
            border-radius: 8px;
            line-height: 1.6;
            box-shadow: 0 2px 4px rgba(49, 130, 206, 0.08);
        }
        
        .result-info strong {
            color: #1a202c;
            font-weight: 600;
        }
        
        .widget-preview {
            margin-top: 25px;
            padding: 25px;
            background: #f8fafc;
            border-radius: 12px;
            border: 2px dashed #cbd5e0;
            overflow: hidden;
        }
        
        .widget-container {
            min-height: 200px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .widget-container-3m {
            min-height: 200px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }

        .widget-container-1y {
            min-height: 200px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 100%;
        }
        
        .widget-container-1y::-webkit-scrollbar {
            height: 8px;
        }
        
        .widget-container-1y::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .widget-container-1y::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        .widget-container-1y::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .code-snippet {
            margin-top: 20px;
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'SFMono-Regular', Consolas, monospace;
            font-size: 14px;
            overflow-x: auto;
            position: relative;
        }
        
        .copy-button {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #4a5568;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .copy-button:hover {
            background: #2d3748;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 30px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
            width: 0%;
        }
        
        .help-text {
            font-size: 14px;
            color: #718096;
            margin-top: 10px;
        }
        
        .example-urls {
            margin-top: 15px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .example-urls h4 {
            margin: 0 0 10px 0;
            color: #2d3748;
            font-size: 14px;
        }
        
        .example-urls ul {
            margin: 0;
            padding-left: 20px;
            color: #4a5568;
            font-size: 13px;
        }
        
        .example-urls li {
            margin-bottom: 5px;
        }
        
        .example-urls a {
            color: #667eea;
            text-decoration: none;
            cursor: pointer;
        }
        
        .example-urls a:hover {
            
        }
        
        .loading-typing::after {
            content: '';
            animation: typing 1.5s steps(3) infinite;
        }

        @keyframes typing {
            0% { content: ''; }
            33% { content: '.'; }
            66% { content: '..'; }
            100% { content: '...'; }
        }

    </style>
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <div class="header">
            <h1>🎯 Blog Activity Widget 테스트</h1>
            <p>내 블로그에 위젯을 적용하기 전에 미리 테스트해보세요</p>
        </div>

        <!-- 블로그 주소 입력 -->
        <div class="blog-input-section">
            <h2>🌐 블로그 주소 입력</h2>
            <div class="input-group">
                <label for="blog-url">블로그 URL:</label>
                <input type="url" id="blog-url" placeholder="https://your-blog.com" value="">
                <button class="btn btn-primary" onclick="startTest()">테스트 시작</button>
            </div>
            <div class="help-text">
                티스토리 블로그 주소를 입력하면 자동으로 RSS 피드를 찾아 테스트합니다.
            </div>
        </div>

        <!-- 진행 상황 -->
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>

        <!-- 1단계: RSS 피드 URL 확인 -->
        <div class="test-step" id="step-1">
            <div class="step-header">
                <div class="step-title">
                    <span class="step-number">1</span>
                    RSS 피드 URL 확인
                </div>
                <div class="step-status status-pending" id="status-1">
                    <span>대기 중</span>
                </div>
            </div>
            <div class="step-content">
                입력한 블로그 주소에서 RSS 피드 URL을 찾고 접근 가능한지 확인합니다.
            </div>
            <div class="step-result" id="result-1" style="display: none;"></div>
        </div>

        <!-- 2단계: 프록시 서버 상태 및 요청 확인 -->
        <div class="test-step" id="step-2">
            <div class="step-header">
                <div class="step-title">
                    <span class="step-number">2</span>
                    프록시 서버 상태 및 요청 확인
                </div>
                <div class="step-status status-pending" id="status-2">
                    <span>대기 중</span>
                </div>
            </div>
            <div class="step-content">
                위젯이 RSS 데이터를 가져오기 위한 프록시 서버가 정상 작동하는지 확인하고, 실제 RSS 데이터를 가져올 수 있는지 테스트합니다.
            </div>
            <div class="step-result" id="result-2" style="display: none;"></div>
        </div>

        <!-- 3단계: RSS 분석 서비스 확인 -->
        <div class="test-step" id="step-3">
            <div class="step-header">
                <div class="step-title">
                    <span class="step-number">3</span>
                    RSS 분석 서비스 확인
                </div>
                <div class="step-status status-pending" id="status-3">
                    <span>대기 중</span>
                </div>
            </div>
            <div class="step-content">
                RSS 피드를 분석하여 날짜별 게시물 수를 계산할 수 있는지 확인합니다.
            </div>
            <div class="step-result" id="result-3" style="display: none;"></div>
        </div>

        <!-- 4단계: 위젯 CDN 로드 상태 확인 -->
        <div class="test-step" id="step-4">
            <div class="step-header">
                <div class="step-title">
                    <span class="step-number">4</span>
                    위젯 라이브러리 상태 확인
                </div>
                <div class="step-status status-pending" id="status-4">
                    <span>대기 중</span>
                </div>
            </div>
            <div class="step-content">
                위젯 라이브러리가 정상적으로 로드되는지 확인합니다.
            </div>
            <div class="step-result" id="result-4" style="display: none;"></div>
        </div>

        <!-- 5단계: 위젯 미리보기 -->
        <div class="test-step" id="step-5">
            <div class="step-header">
                <div class="step-title">
                    <span class="step-number">5</span>
                    위젯 미리보기
                </div>
                <div class="step-status status-pending" id="status-5">
                    <span>대기 중</span>
                </div>
            </div>
            <div class="step-content">
                실제 위젯을 생성하여 미리보기를 제공하고, 블로그에 적용할 수 있는 코드를 제공합니다.
            </div>
            <div class="step-result" id="result-5" style="display: none;"></div>
            <div class="widget-preview" id="widget-preview" style="display: none;">
                <h3>📅 3개월 버전 위젯</h3>
                <div class="widget-container" id="widget-3m"></div>
                
                <h4 style="margin-top: 20px; color: #4a5568; font-size: 16px;">🏷️ 방식 1: HTML 데이터 속성 (권장)</h4>
                <div class="code-snippet" id="code-3m-data">
                    <button class="copy-button" onclick="copyCode('code-3m-data-content')">복사</button>
                    <div id="code-3m-data-content"></div>
                </div>
                
                <h4 style="margin-top: 15px; color: #4a5568; font-size: 16px;">🔧 방식 2: JavaScript 코드</h4>
                <div class="code-snippet" id="code-3m-js">
                    <button class="copy-button" onclick="copyCode('code-3m-js-content')">복사</button>
                    <div id="code-3m-js-content"></div>
                </div>

                <h3 style="margin-top: 30px;">📅 1년 버전 위젯</h3>
                <div class="widget-container-1y" id="widget-1y"></div>
                <div class="help-text" style="margin-top: 10px;">← 좌우로 스크롤하여 전체 위젯을 확인하세요</div>
                
                <h4 style="margin-top: 20px; color: #4a5568; font-size: 16px;">🏷️ 방식 1: HTML 데이터 속성 (권장)</h4>
                <div class="code-snippet" id="code-1y-data">
                    <button class="copy-button" onclick="copyCode('code-1y-data-content')">복사</button>
                    <div id="code-1y-data-content"></div>
                </div>
                
                <h4 style="margin-top: 15px; color: #4a5568; font-size: 16px;">🔧 방식 2: JavaScript 코드</h4>
                <div class="code-snippet" id="code-1y-js">
                    <button class="copy-button" onclick="copyCode('code-1y-js-content')">복사</button>
                    <div id="code-1y-js-content"></div>
                </div>
            </div>
        </div>

        <!-- 6단계: 커스텀 위젯 예시 -->
        <div class="test-step" id="step-6">
            <div class="step-header">
                <div class="step-title">
                    <span class="step-number">6</span>
                    커스텀 위젯 예시
                </div>
                <div class="step-status status-pending" id="status-6">
                    <span>대기 중</span>
                </div>
            </div>
            <div class="step-content">
                JavaScript 방식에서 title, colors 등의 옵션을 커스터마이징한 위젯 예시입니다.
            </div>
            <div class="step-result" id="result-6" style="display: none;"></div>
            <div class="widget-preview" id="widget-custom-preview" style="display: none;">
                <h3>🎨 3개월 커스텀 위젯</h3>
                <div class="widget-container-3m" id="widget-custom-3m"></div>
                
                <h4 style="margin-top: 20px; color: #4a5568; font-size: 16px;">🔧 JavaScript 코드</h4>
                <div class="code-snippet" id="code-custom-3m">
                    <button class="copy-button" onclick="copyCode('code-custom-3m-content')">복사</button>
                    <div id="code-custom-3m-content"></div>
                </div>

                <h3 style="margin-top: 30px;">🎨 1년 커스텀 위젯</h3>
                <div class="widget-container-1y" id="widget-custom-1y"></div>
                <div class="help-text" style="margin-top: 10px;">← 좌우로 스크롤하여 전체 위젯을 확인하세요</div>
                
                <h4 style="margin-top: 20px; color: #4a5568; font-size: 16px;">🔧 JavaScript 코드</h4>
                <div class="code-snippet" id="code-custom-1y">
                    <button class="copy-button" onclick="copyCode('code-custom-1y-content')">복사</button>
                    <div id="code-custom-1y-content"></div>
                </div>
            </div>
        </div>
    </div>
        </div>
    </div>

    <!-- 위젯 라이브러리 로드 -->
    <script src="https://unpkg.com/blog-garden-widget@latest/blog-garden-widget.js"></script>
    <script src="https://unpkg.com/blog-garden-widget@latest/blog-garden-widget-1y.js"></script>
    <script src="https://unpkg.com/blog-garden-widget@latest/blog-garden-widget-3m.js"></script>
    
    <script>
        let currentBlogUrl = '';
        let currentRssUrl = '';
        let testProgress = 0;
        
        // 예시 URL 설정
        function setExampleUrl(url) {
            document.getElementById('blog-url').value = url;
        }
        
        // 테스트 시작
        async function startTest() {
            const blogUrl = document.getElementById('blog-url').value.trim();
            
            if (!blogUrl) {
                alert('블로그 주소를 입력해주세요.');
                return;
            }
            
            try {
                new URL(blogUrl);
            } catch (e) {
                alert('올바른 URL 형식을 입력해주세요.');
                return;
            }
            
            currentBlogUrl = blogUrl;
            testProgress = 0;
            updateProgress(0);
            
            // 모든 단계 초기화
            for (let i = 1; i <= 6; i++) {
                resetStep(i);
            }
            
            // 단계별 테스트 실행
            await runStep1();
        }
        
        // 단계 초기화
        function resetStep(stepNum) {
            const step = document.getElementById(`step-${stepNum}`);
            const status = document.getElementById(`status-${stepNum}`);
            const result = document.getElementById(`result-${stepNum}`);
            
            if (step) step.className = 'test-step';
            if (status) {
                status.className = 'step-status status-pending';
                status.innerHTML = '<span>대기 중</span>';
            }
            if (result) result.style.display = 'none';
            
            // 5단계인 경우 완료 메시지와 위젯 미리보기 숨기기
            if (stepNum === 5) {
                const completionMessage = document.getElementById('completion-message');
                const widgetPreview = document.getElementById('widget-preview');
                if (completionMessage) {
                    completionMessage.style.display = 'none';
                }
                if (widgetPreview) {
                    widgetPreview.style.display = 'none';
                }
            }
            
            // 6단계인 경우 커스텀 위젯 미리보기 숨기기
            if (stepNum === 6) {
                const widgetCustomPreview = document.getElementById('widget-custom-preview');
                if (widgetCustomPreview) {
                    widgetCustomPreview.style.display = 'none';
                }
            }
        }
        
        // 단계 상태 업데이트
        function updateStepStatus(stepNum, status, message) {
            const step = document.getElementById(`step-${stepNum}`);
            const statusEl = document.getElementById(`status-${stepNum}`);
            const resultEl = document.getElementById(`result-${stepNum}`);
            
            if (!step || !statusEl || !resultEl) {
                console.error(`단계 ${stepNum}의 DOM 요소를 찾을 수 없습니다:`, { step, statusEl, resultEl });
                return;
            }
            
            // 단계 클래스 업데이트
            step.className = `test-step ${status}`;
            
            // 상태 업데이트
            switch (status) {
                case 'testing':
                    statusEl.className = 'step-status status-testing';
                    statusEl.innerHTML = '<span>⚡⌛️ 테스트 중<span class="loading-typing"></span></span>';
                    break;
                case 'completed':
                    statusEl.className = 'step-status status-success';
                    statusEl.innerHTML = '<span>✅ 완료</span>';
                                         testProgress = stepNum * (100/6);
                    updateProgress(testProgress);
                    break;
                case 'error':
                    statusEl.className = 'step-status status-error';
                    statusEl.innerHTML = '<span>❌ 실패</span>';
                    break;
            }
            
            // 결과 메시지 표시
            if (message) {
                resultEl.innerHTML = message;
                resultEl.style.display = 'block';
            }
        }
        
        // 진행률 업데이트
        function updateProgress(percent) {
            document.getElementById('progress-fill').style.width = percent + '%';
        }
        
        // 1단계: RSS 피드 URL 확인
        async function runStep1() {
            updateStepStatus(1, 'testing');
            
            try {
                // 일반적인 RSS 피드 URL 패턴들 시도
                const rssPatterns = [
                    '/rss',
                    '/feed',
                    '/atom.xml',
                    '/rss.xml',
                    '/feed.xml'
                ];
                
                let foundRss = null;
                const baseUrl = currentBlogUrl.replace(/\/$/, '');
                
                for (const pattern of rssPatterns) {
                    const rssUrl = baseUrl + pattern;
                    try {
                                                 const response = await fetch(`https://blog-graden.vercel.app/proxy/rss?url=${encodeURIComponent(rssUrl)}`);
                        if (response.ok) {
                            const content = await response.text();
                            if (content.includes('<rss') || content.includes('<feed')) {
                                foundRss = rssUrl;
                                break;
                            }
                        }
                    } catch (e) {
                        // 계속 시도
                    }
                }
                
                                 if (foundRss) {
                     currentRssUrl = foundRss;
                     updateStepStatus(1, 'completed', `<div class="result-success">✅ RSS 피드 확인 성공!<br>블로그에서 게시물 정보를 정상적으로 가져올 수 있습니다.</div>`);
                     setTimeout(() => runStep2(), 1000);
                 } else {
                     const checkedUrls = rssPatterns.map(p => `<a href="${baseUrl + p}" target="_blank" style="color: #0969da; ">${baseUrl + p}</a>`).join('<br>');
                     updateStepStatus(1, 'error', `<div class="result-error">❌ RSS 피드를 찾을 수 없습니다.<br>다음 URL들을 확인했습니다:<br>${checkedUrls}</div>`);
                 }
                
            } catch (error) {
                updateStepStatus(1, 'error', `<div class="result-error">❌ 오류 발생: ${error.message}</div>`);
            }
        }
        
                // 2단계: 프록시 서버 상태 및 요청 확인
        async function runStep2() {
            updateStepStatus(2, 'testing');
            
            let resultMessage = '';
            let allSuccess = true;
            
            // 1) 프록시 서버 상태 확인
            try {
                const healthResponse = await fetch('https://blog-graden.vercel.app/health');
                
                                 const healthUrl = 'https://blog-graden.vercel.app/health';
                 if (healthResponse.ok) {
                     const health = await healthResponse.json();
                     resultMessage += `<div class="result-success" style="margin-bottom: 15px;">
                         <strong>✅ 프록시 서버 상태 확인 성공!</strong><br>
                         프록시 서버가 정상적으로 작동하고 있습니다.
                     </div>`;
                 } else {
                     resultMessage += `<div class="result-error" style="margin-bottom: 15px;">
                         <strong>❌ 프록시 서버 상태 확인 실패!</strong><br>
                         <strong>응답 오류:</strong> ${healthResponse.status}<br>
                         <strong>API URL:</strong> <a href="${healthUrl}" target="_blank" style="color: #0969da; ">${healthUrl}</a>
                     </div>`;
                     allSuccess = false;
                 }
            } catch (error) {
                resultMessage += `<div class="result-error" style="margin-bottom: 15px;">
                    <strong>❌ 프록시 서버 상태 확인 실패!</strong><br>
                    <strong>연결 오류:</strong> ${error.message}
                </div>`;
                allSuccess = false;
            }
            
                         // 2) 프록시 서버 요청 테스트
             try {
                 const proxyUrl = `https://blog-graden.vercel.app/proxy/rss?url=${encodeURIComponent(currentRssUrl)}`;
                 const proxyResponse = await fetch(proxyUrl);
                 
                 if (proxyResponse.ok) {
                     const content = await proxyResponse.text();
                     const contentLength = content.length;
                     resultMessage += `<div class="result-success">
                         <strong>✅ 프록시 서버 요청 테스트 성공!</strong><br>
                         RSS 데이터를 성공적으로 가져왔습니다. (${contentLength.toLocaleString()} bytes)
                     </div>`;
                 } else {
                     resultMessage += `<div class="result-error">
                         <strong>❌ 프록시 서버 요청 테스트 실패!</strong><br>
                         <strong>RSS 데이터 가져오기 실패:</strong> ${proxyResponse.status}<br>
                         <strong>API URL:</strong> <a href="${proxyUrl}" target="_blank" style="color: #0969da; ">${proxyUrl}</a>
                     </div>`;
                     allSuccess = false;
                 }
             } catch (error) {
                 const proxyUrl = `https://blog-graden.vercel.app/proxy/rss?url=${encodeURIComponent(currentRssUrl)}`;
                 resultMessage += `<div class="result-error">
                     <strong>❌ 프록시 서버 요청 테스트 실패!</strong><br>
                     <strong>프록시 요청 실패:</strong> ${error.message}<br>
                     <strong>API URL:</strong> <a href="${proxyUrl}" target="_blank" style="color: #0969da; ">${proxyUrl}</a>
                 </div>`;
                 allSuccess = false;
             }
            
            // 결과 표시
            if (allSuccess) {
                updateStepStatus(2, 'completed', resultMessage);
                setTimeout(() => runStep3(), 1000);
            } else {
                updateStepStatus(2, 'error', resultMessage);
            }
        }
        
                // 3단계: RSS 분석 서비스 확인
        async function runStep3() {
            updateStepStatus(3, 'testing');
            
            try {
                const analyzeUrl = `https://blog-graden.vercel.app/analyze/rss?url=${encodeURIComponent(currentRssUrl)}`;
                const response = await fetch(analyzeUrl);
                
                if (response.ok) {
                    const dateCounts = await response.json();
                    const totalPosts = Object.values(dateCounts).reduce((sum, count) => sum + count, 0);
                    const dateCount = Object.keys(dateCounts).length;
                    const recentActivity = Object.keys(dateCounts).sort().pop() || '없음';
                    
                    updateStepStatus(3, 'completed', `<div class="result-success">✅ RSS 분석이 완료되었습니다!<br><strong>총 게시물:</strong> ${totalPosts}개<br><strong>활동 날짜:</strong> ${dateCount}일<br><strong>최근 활동:</strong> ${recentActivity}</div>`);
                    setTimeout(() => runStep4(), 1000);
                } else {
                    updateStepStatus(3, 'error', `<div class="result-error">❌ RSS 분석 실패: ${response.status}<br><strong>API URL:</strong> <a href="${analyzeUrl}" target="_blank" style="color: #0969da;">${analyzeUrl}</a></div>`);
                }
                
            } catch (error) {
                const analyzeUrl = `https://blog-graden.vercel.app/analyze/rss?url=${encodeURIComponent(currentRssUrl)}`;
                updateStepStatus(3, 'error', `<div class="result-error">❌ RSS 분석 오류: ${error.message}<br><strong>API URL:</strong> <a href="${analyzeUrl}" target="_blank" style="color: #0969da;">${analyzeUrl}</a></div>`);
            }
        }
        
        // 4단계: CDN 로드 상태 확인
        async function runStep4() {
            updateStepStatus(4, 'testing');
            
            let checkCount = 0;
            const maxChecks = 10; // 최대 5초간 체크
            
            const checkCDN = () => {
                checkCount++;
                
                                 if (typeof GradenWidget !== 'undefined' && typeof GradenWidget1Y !== 'undefined') {
                     const cdn3mUrl = 'https://unpkg.com/blog-garden-widget@latest/blog-garden-widget.js';
                     const cdn1yUrl = 'https://unpkg.com/blog-garden-widget@latest/blog-garden-widget-1y.js';
                     
                     updateStepStatus(4, 'completed', `<div class="result-success">✅ CDN 로드 성공!<br>모든 위젯 라이브러리가 정상적으로 로드되었습니다.<br><br><strong><br><strong>3개월 위젯</strong><br><div style="background: #1a202c; color: #e2e8f0; padding: 12px; border-radius: 6px; font-family: 'SFMono-Regular', Consolas, monospace; font-size: 14px; margin: 8px 0; position: relative;"><span style="user-select: all;">&lt;script src="${cdn3mUrl}"&gt;&lt;/script&gt;</span></div><br><strong>1년 위젯</strong><br><div style="background: #1a202c; color: #e2e8f0; padding: 12px; border-radius: 6px; font-family: 'SFMono-Regular', Consolas, monospace; font-size: 14px; margin: 8px 0; position: relative;"><span style="user-select: all;">&lt;script src="${cdn1yUrl}"&gt;&lt;/script&gt;</span></div></div>`);
                     setTimeout(() => runStep5(), 1000);
                 } else if (checkCount < maxChecks) {
                     setTimeout(checkCDN, 500);
                 } else {
                     const gradenStatus = typeof GradenWidget !== 'undefined' ? '로드됨' : '로드 실패';
                     const graden1YStatus = typeof GradenWidget1Y !== 'undefined' ? '로드됨' : '로드 실패';
                     const cdn3mUrl = 'https://unpkg.com/blog-garden-widget@latest/blog-garden-widget.js';
                     const cdn1yUrl = 'https://unpkg.com/blog-garden-widget@latest/blog-garden-widget-1y.js';
                     
                     updateStepStatus(4, 'error', `<div class="result-error">❌ CDN 로드 실패!<br><strong>3개월 위젯:</strong> GradenWidget ${gradenStatus}<br><strong>1년 위젯:</strong> GradenWidget1Y ${graden1YStatus}<br><strong>3개월 CDN URL:</strong> <a href="${cdn3mUrl}" target="_blank" style="color: #0969da; ">${cdn3mUrl}</a><br><strong>1년 CDN URL:</strong> <a href="${cdn1yUrl}" target="_blank" style="color: #0969da; ">${cdn1yUrl}</a><br>네트워크 연결을 확인해주세요.</div>`);
                 }
            };
            
            checkCDN();
        }
        
        // 5단계: 위젯 미리보기
        async function runStep5() {
            updateStepStatus(5, 'testing');
            
            try {
                // CDN 로드 상태 재확인
                if (typeof GradenWidget === 'undefined' || typeof GradenWidget1Y === 'undefined') {
                    throw new Error('위젯 클래스가 로드되지 않았습니다. CDN 로드를 다시 확인해주세요.');
                }
                
                // RSS URL 확인
                if (!currentRssUrl) {
                    throw new Error('RSS URL이 설정되지 않았습니다.');
                }
                
                // 위젯 미리보기 섹션 표시
                const widgetPreview = document.getElementById('widget-preview');
                if (widgetPreview) {
                    widgetPreview.style.display = 'block';
                } else {
                    throw new Error('widget-preview 요소를 찾을 수 없습니다.');
                }
                
                // 3개월 위젯 생성
                const widget3m = document.getElementById('widget-3m');
                if (!widget3m) {
                    throw new Error('widget-3m 요소를 찾을 수 없습니다.');
                }
                widget3m.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">3개월 위젯 로딩 중...</div>';
                
                try {
                    console.log('3개월 위젯 생성 시도:', { rssUrl: currentRssUrl, blogUrl: currentBlogUrl });
                    new GradenWidget(widget3m, {
                        rssUrl: currentRssUrl,
                        title: `활동 기록`,
                        showLegend: true,
                        showFooter: true
                    });
                    console.log('3개월 위젯 생성 성공');
                } catch (widgetError) {
                    console.error('3개월 위젯 생성 실패:', widgetError);
                    widget3m.innerHTML = `<div style="color: #e53e3e; padding: 20px; text-align: center;">3개월 위젯 생성 실패: ${widgetError.message}</div>`;
                }
                
                // 1년 위젯 생성
                const widget1y = document.getElementById('widget-1y');
                if (!widget1y) {
                    throw new Error('widget-1y 요소를 찾을 수 없습니다.');
                }
                widget1y.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">1년 위젯 로딩 중...</div>';
                
                try {
                    console.log('1년 위젯 생성 시도:', { rssUrl: currentRssUrl, blogUrl: currentBlogUrl });
                    new GradenWidget1Y(widget1y, {
                        rssUrl: currentRssUrl,
                        title: `1년 활동 기록`,
                        showLegend: true,
                        showFooter: true
                    });
                    console.log('1년 위젯 생성 성공');
                } catch (widgetError) {
                    console.error('1년 위젯 생성 실패:', widgetError);
                    widget1y.innerHTML = `<div style="color: #e53e3e; padding: 20px; text-align: center;">1년 위젯 생성 실패: ${widgetError.message}</div>`;
                }

                                                
                // 코드 스니펫 생성
                generateCodeSnippets();
                
                // 완료 메시지 표시
                const completionMessage = document.getElementById('completion-message');
                if (completionMessage) {
                    completionMessage.style.display = 'block';
                } else {
                    console.warn('completion-message 요소를 찾을 수 없습니다.');
                }
                updateStepStatus(5, 'completed', '');
                setTimeout(() => runStep6(), 1000);

            } catch (error) {
                updateStepStatus(5, 'error', `<div class="result-error">❌ 위젯 생성 실패: ${error.message}<br><strong>현재 상태:</strong><br>- RSS URL: ${currentRssUrl || '없음'}<br>- GradenWidget: ${typeof GradenWidget !== 'undefined' ? '로드됨' : '로드 안됨'}<br>- GradenWidget1Y: ${typeof GradenWidget1Y !== 'undefined' ? '로드됨' : '로드 안됨'}</div>`);
            }
        }
        
        // 6단계: 커스텀 위젯 예시
        async function runStep6() {
            updateStepStatus(6, 'testing');
            
            try {
                // CDN 로드 상태 재확인
                if (typeof GradenWidget3M === 'undefined' || typeof GradenWidget1Y === 'undefined') {
                    throw new Error('GradenWidget3M 또는 GradenWidget1Y 클래스가 로드되지 않았습니다.');
                }
                
                // RSS URL 확인
                if (!currentRssUrl) {
                    throw new Error('RSS URL이 설정되지 않았습니다.');
                }
                
                // 커스텀 위젯 미리보기 섹션 표시
                const widgetCustomPreview = document.getElementById('widget-custom-preview');
                if (widgetCustomPreview) {
                    widgetCustomPreview.style.display = 'block';
                } else {
                    throw new Error('widget-custom-preview 요소를 찾을 수 없습니다.');
                }
                
                // 3개월 커스텀 색상 위젯 생성
                const widgetCustom3M = document.getElementById('widget-custom-3m');
                if (!widgetCustom3M) {
                    throw new Error('widget-custom-3m 요소를 찾을 수 없습니다.');
                }
                widgetCustom3M.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">3개월 커스텀 위젯 로딩 중...</div>';
                
                try {
                    console.log('3개월 커스텀 위젯 생성 시도:', { rssUrl: currentRssUrl, blogUrl: currentBlogUrl });
                    new GradenWidget3M(widgetCustom3M, {
                        rssUrl: currentRssUrl,
                        title: `블로그 포도`,
                        showLegend: true,
                        colors: {
                            0: '#ede9fe',  
                            1: '#c4b5fd', 
                            2: '#a99be9', 
                            3: '#7c3aed',  
                            4: '#4c1d95'  
                        }
                    });
                    console.log('3개월 커스텀 위젯 생성 성공');
                } catch (widgetError) {
                    console.error('3개월 커스텀 위젯 생성 실패:', widgetError);
                    widgetCustom3M.innerHTML = `<div style="color: #e53e3e; padding: 20px; text-align: center;">3개월 커스텀 위젯 생성 실패: ${widgetError.message}</div>`;
                }

                // 1년 커스텀 색상 위젯 생성
                const widgetCustom1Y = document.getElementById('widget-custom-1y');
                if (!widgetCustom1Y) {
                    throw new Error('widget-custom-1y 요소를 찾을 수 없습니다.');
                }
                widgetCustom1Y.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">1년 커스텀 위젯 로딩 중...</div>';
                
                try {
                    console.log('1년 커스텀 위젯 생성 시도:', { rssUrl: currentRssUrl, blogUrl: currentBlogUrl });
                    new GradenWidget1Y(widgetCustom1Y, {
                        rssUrl: currentRssUrl,
                        title: `블로그 포도 (1년)`,
                        showLegend: true,
                        colors: {
                            0: '#ede9fe',  
                            1: '#c4b5fd', 
                            2: '#a99be9', 
                            3: '#7c3aed',  
                            4: '#4c1d95'  
                        }
                    });
                    console.log('1년 커스텀 위젯 생성 성공');
                } catch (widgetError) {
                    console.error('1년 커스텀 위젯 생성 실패:', widgetError);
                    widgetCustom1Y.innerHTML = `<div style="color: #e53e3e; padding: 20px; text-align: center;">1년 커스텀 위젯 생성 실패: ${widgetError.message}</div>`;
                }
                
                updateStepStatus(6, 'completed', '');

            } catch (error) {
                updateStepStatus(6, 'error', `<div class="result-error">❌ 커스텀 위젯 생성 실패: ${error.message}</div>`);
            }
        }
        
                 // 코드 스니펫 생성
         function generateCodeSnippets() {
             // 3개월 위젯 - JavaScript 방식
             const code3mJs = `<script src="https://unpkg.com/blog-garden-widget@latest/blog-garden-widget.js"><\/script>
<div id="blog-garden-widget"><\/div>
<script>
new GradenWidget(document.getElementById('blog-garden-widget'), {
    rssUrl: '${currentRssUrl}',
    title: '활동 기록',
    showLegend: true,
});
<\/script>`;

             // 3개월 위젯 - 데이터 속성 방식
             const code3mData = `<script src="https://unpkg.com/blog-garden-widget@latest/blog-garden-widget.js"><\/script>
<div data-graden-widget data-rss-url="${currentRssUrl}">
</div>`;

             // 1년 위젯 - JavaScript 방식
             const code1yJs = `<script src="https://unpkg.com/blog-garden-widget@latest/blog-garden-widget-1y.js"><\/script>
<div id="blog-garden-widget-1y"><\/div>
<script>
new GradenWidget1Y(document.getElementById('blog-garden-widget-1y'), {
    rssUrl: '${currentRssUrl}',
    title: '1년 활동 기록',
    showLegend: true,
});
<\/script>`;

             // 1년 위젯 - 데이터 속성 방식
             const code1yData = `<script src="https://unpkg.com/blog-garden-widget@latest/blog-garden-widget-1y.js"><\/script>
<div data-graden-widget-1y data-rss-url="${currentRssUrl}">
</div>`;

             // 커스텀 색상 3개월 위젯 코드
             const code3mCustom = `<script src="https://unpkg.com/blog-garden-widget@latest/blog-garden-widget-3m.js"><\/script>
<div id="blog-garden-widget-3m"><\/div>
<script>
new GradenWidget3M(document.getElementById('blog-garden-widget-3m'), {
    rssUrl: '${currentRssUrl}',
    title: '블로그 포도 (3개월)',
    showLegend: true,
    colors: {
        0: '#ede9fe',  
        1: '#c4b5fd', 
        2: '#a99be9',  
        3: '#7c3aed',  
        4: '#4c1d95'  
    }
});
<\/script>`;

             // 커스텀 색상 1년 위젯 코드
             const code1yCustom = `<script src="https://unpkg.com/blog-garden-widget@latest/blog-garden-widget-1y.js"><\/script>
<div id="blog-garden-widget-1y"><\/div>
<script>
new GradenWidget1Y(document.getElementById('blog-garden-widget-1y'), {
    rssUrl: '${currentRssUrl}',
    title: '블로그 포도 (1년)',
    showLegend: true,
    colors: {
        0: '#ede9fe',  
        1: '#c4b5fd', 
        2: '#a99be9',  
        3: '#7c3aed',  
        4: '#4c1d95'  
    }
});
<\/script>`;
             
             // 코드 스니펫 적용
             document.getElementById('code-3m-js-content').textContent = code3mJs;
             document.getElementById('code-3m-data-content').textContent = code3mData;
             document.getElementById('code-1y-js-content').textContent = code1yJs;
             document.getElementById('code-1y-data-content').textContent = code1yData;
             document.getElementById('code-custom-3m-content').textContent = code3mCustom;
             document.getElementById('code-custom-1y-content').textContent = code1yCustom;
         }
        
        // 코드 복사
        function copyCode(elementId) {
            const code = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('코드가 클립보드에 복사되었습니다!');
            }).catch(() => {
                alert('복사에 실패했습니다. 수동으로 복사해주세요.');
            });
        }
        
        // 페이지 로드 시 CDN 상태 미리 확인
        window.addEventListener('load', function() {
            // 5초 후에 CDN 로드 상태를 미리 체크
            setTimeout(() => {
                if (typeof GradenWidget === 'undefined' || typeof GradenWidget1Y === 'undefined') {
                    console.warn('위젯 클래스가 로드되지 않았습니다.');
                }
            }, 5000);
        });
    </script>
</body>
</html> 